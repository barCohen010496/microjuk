<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <meta name="theme-color" content="#0A0000"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="MICROJUK"/>
  <title>MICROJUK | ××—×©×‘×•×Ÿ ××—×™×¨ ×’×œ×™×œ</title>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --red:       #CC0000;
      --red-light: #FF4444;
      --red-dark:  #990000;
      --black:     #0A0000;
      --black-mid: #1C0000;
      --card-bg:   rgba(255,255,255,0.06);
      --card-border: rgba(204,0,0,0.35);
      --label:     #FFAAAA;
      --sublabel:  #FFCCCC;
      --muted:     #AA6666;
      --footer:    #663333;
    }

    html, body {
      min-height: 100%;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, var(--black) 0%, var(--black-mid) 50%, var(--black) 100%);
      color: #fff;
      direction: rtl;
    }

    body {
      padding: 16px;
      padding-bottom: 32px;
    }

    /* â”€â”€ CARDS â”€â”€ */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 22px;
      margin-bottom: 16px;
      box-shadow: 0 4px 24px rgba(204,0,0,0.12);
      backdrop-filter: blur(6px);
    }

    /* â”€â”€ HEADER â”€â”€ */
    .header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .gear {
      font-size: 38px;
      background: linear-gradient(to left, #fff, var(--red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
    }

    .brand-name {
      font-size: 24px;
      font-weight: 900;
      letter-spacing: 3px;
      direction: ltr;
      background: linear-gradient(to left, #fff, var(--red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .brand-sub {
      font-size: 14px;
      color: var(--muted);
      margin-top: 3px;
      direction: rtl;
    }

    /* â”€â”€ SECTION TITLE â”€â”€ */
    .section-title {
      font-size: 17px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 18px;
    }

    /* â”€â”€ LABELS & INPUTS â”€â”€ */
    .field { margin-bottom: 14px; }

    .field-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--label);
      margin-bottom: 6px;
      display: block;
    }

    input[type="number"] {
      width: 100%;
      background: rgba(255,255,255,0.07);
      border: 1.5px solid var(--red);
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
      font-family: inherit;
      padding: 11px 14px;
      outline: none;
      direction: ltr;
      text-align: right;
      transition: border-color 0.2s, box-shadow 0.2s;
      -webkit-appearance: none;
      appearance: none;
    }

    input[type="number"]:focus {
      border-color: var(--red-light);
      box-shadow: 0 0 0 3px rgba(204,0,0,0.25);
    }

    input[type="number"]::placeholder { color: rgba(255,180,180,0.4); }

    /* hide number spinners */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }

    /* â”€â”€ BUTTON â”€â”€ */
    .btn-calc {
      width: 100%;
      height: 50px;
      background: linear-gradient(to left, var(--red), var(--red-dark));
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 17px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      margin-top: 6px;
      transition: opacity 0.15s, transform 0.1s;
      -webkit-tap-highlight-color: transparent;
    }

    .btn-calc:active { opacity: 0.78; transform: scale(0.98); }

    /* â”€â”€ ERROR â”€â”€ */
    .error-msg {
      display: none;
      color: var(--red-light);
      font-size: 14px;
      text-align: center;
      margin-top: 10px;
    }

    /* â”€â”€ RESULTS CARD â”€â”€ */
    #results-card { display: none; }

    .result-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .result-row-label {
      font-size: 15px;
      color: var(--sublabel);
    }

    .result-row-value {
      font-size: 16px;
      font-weight: 600;
      font-family: Consolas, 'Courier New', monospace;
      color: #fff;
    }

    .divider {
      height: 1px;
      background: linear-gradient(to left, transparent, var(--red), transparent);
      margin: 12px 0;
    }

    .price-ex-vat { color: #FF6666; font-size: 18px; font-weight: 700; font-family: Consolas, monospace; }
    .vat-val      { color: var(--muted); font-size: 16px; font-weight: 600; font-family: Consolas, monospace; }

    /* Final price box */
    .final-box {
      background: linear-gradient(to left, #1A0000, #3D0000);
      border: 1px solid transparent;
      border-radius: 12px;
      padding: 14px 16px;
      margin-top: 8px;
      position: relative;
    }

    .final-box::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 12px;
      border: 1px solid transparent;
      background: linear-gradient(to left, #fff, var(--red)) border-box;
      -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: destination-out;
      mask-composite: exclude;
    }

    .final-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .final-label {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
    }

    .final-value {
      font-size: 26px;
      font-weight: 700;
      font-family: Consolas, 'Courier New', monospace;
      background: linear-gradient(to left, #fff, var(--red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* â”€â”€ DISCOUNT CARD â”€â”€ */
    #discount-card { display: none; }

    .discount-result-box {
      background: linear-gradient(to left, #001A00, #003D00);
      border: 1px solid #00CC55;
      border-radius: 12px;
      padding: 14px 16px;
      display: none;
      margin-top: 4px;
    }

    .discount-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .discount-row-label { font-size: 15px; color: #88FFBB; }
    .discount-row-value { font-size: 16px; font-weight: 600; font-family: Consolas, monospace; color: #88FFBB; }

    .discount-final-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 8px;
      border-top: 1px solid rgba(0,200,80,0.25);
    }

    .discount-final-label { font-size: 16px; font-weight: 700; color: #fff; }

    .discount-final-value {
      font-size: 26px;
      font-weight: 700;
      font-family: Consolas, monospace;
      background: linear-gradient(to left, #fff, #00CC55);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* â”€â”€ SCI-CALC BUTTON â”€â”€ */
    .btn-sci {
      width: 100%;
      height: 48px;
      background: linear-gradient(to left, #1a1a3e, #2d2d6b);
      border: 1px solid #4444AA;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      margin-bottom: 16px;
      transition: opacity 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-sci:active { opacity: 0.75; }

    /* â”€â”€ MODAL â”€â”€ */
    #calc-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    #calc-modal.open { display: flex; }

    .calc-panel {
      background: #1E1E2E;
      border-radius: 18px;
      padding: 16px;
      width: 100%;
      max-width: 380px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.7);
      position: relative;
    }

    .calc-close {
      position: absolute;
      top: 10px;
      left: 12px;
      background: #F38BA8;
      border: none;
      border-radius: 8px;
      color: #1E1E2E;
      font-size: 14px;
      font-weight: 700;
      width: 30px;
      height: 30px;
      cursor: pointer;
      line-height: 1;
    }

    .calc-title {
      text-align: center;
      color: #CDD6F4;
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 12px;
      direction: ltr;
    }

    .calc-display {
      background: #181825;
      border-radius: 10px;
      padding: 10px 14px;
      margin-bottom: 8px;
      text-align: right;
      direction: ltr;
    }
    .calc-expr { color: #6C7086; font-size: 12px; min-height: 16px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .calc-main { color: #CDD6F4; font-size: 32px; font-weight: 300; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .calc-angle {
      display: flex;
      justify-content: flex-end;
      gap: 14px;
      margin-bottom: 6px;
    }
    .calc-angle label { color: #89B4FA; font-size: 11px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 3px; direction: ltr; }

    .calc-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
    }

    .cb {
      height: 44px;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      transition: opacity 0.12s;
      -webkit-tap-highlight-color: transparent;
    }
    .cb:active { opacity: 0.6; }

    .cb-num { background: #313244; color: #CDD6F4; }
    .cb-op  { background: #45475A; color: #CDD6F4; }
    .cb-fn  { background: #313244; color: #89B4FA; font-size: 11px; }
    .cb-eq  { background: #89B4FA; color: #1E1E2E; }
    .cb-clr { background: #F38BA8; color: #1E1E2E; }
    .cb-acc { background: #FAB387; color: #1E1E2E; }

    /* â”€â”€ FOOTER â”€â”€ */
    .footer {
      text-align: center;
      color: var(--footer);
      font-size: 12px;
      margin-top: 8px;
      direction: ltr;
    }

    /* â”€â”€ INSTALL BANNER â”€â”€ */
    #install-banner {
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      background: rgba(204,0,0,0.15);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 16px;
      font-size: 14px;
      color: var(--label);
    }

    #install-banner button {
      background: var(--red);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      font-weight: 700;
      padding: 7px 14px;
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
    }

    @media (min-width: 480px) {
      body { max-width: 460px; margin: 0 auto; padding: 24px 16px; }
      .brand-name { font-size: 26px; }
    }
  </style>
</head>
<body>

  <!-- Install Banner (shows on supported browsers) -->
  <div id="install-banner">
    <span>ğŸ“² ×”×•×¡×£ ×œ×©×•×œ×—×Ÿ ×”×‘×™×ª ×©×œ×š</span>
    <button id="install-btn">×”×ª×§×Ÿ</button>
  </div>

  <!-- Header -->
  <div class="card">
    <div class="header">
      <img src="logo.png" alt="MICROJUK" style="height:80px;display:block;margin:0 auto 8px;"/>
      <div class="brand-sub" style="text-align:center;">××—×©×‘×•×Ÿ ××—×™×¨ ×’×œ×™×œ</div>
    </div>
  </div>

  <!-- Input Card -->
  <div class="card">
    <div class="section-title">×”×–×Ÿ ×¤×¨×˜×™ ×’×œ×™×œ</div>

    <div class="field">
      <label class="field-label" for="cylinderLength">ğŸ“ ××•×¨×š ×’×œ×™×œ (×¡× ×˜×™××˜×¨×™×)</label>
      <input type="number" id="cylinderLength" placeholder="×œ×“×•×’××”: 150" min="0" step="any"/>
    </div>

    <div class="field">
      <label class="field-label" for="runningMeter">â†” ××˜×¨ ×¨×¥</label>
      <input type="number" id="runningMeter" placeholder="×œ×“×•×’××”: 1.5" min="0" step="any"/>
    </div>

    <div class="field" style="margin-bottom: 20px;">
      <label class="field-label" for="pricePerMeter">â‚ª ××—×™×¨ ×œ××˜×¨</label>
      <input type="number" id="pricePerMeter" placeholder="×œ×“×•×’××”: 80" min="0" step="any"/>
    </div>

    <button class="btn-calc" onclick="calculate()">ğŸ”¢ ×—×©×‘ ××—×™×¨</button>
    <div class="error-msg" id="error-msg"></div>
  </div>

  <!-- Results Card -->
  <div class="card" id="results-card">
    <div class="section-title">âœ… ×ª×•×¦××•×ª ×”×—×™×©×•×‘</div>

    <div class="result-row">
      <span class="result-row-label">××•×¨×š ×’×œ×™×œ</span>
      <span class="result-row-value" id="res-length"></span>
    </div>
    <div class="result-row">
      <span class="result-row-label">××˜×¨ ×¨×¥</span>
      <span class="result-row-value" id="res-running"></span>
    </div>
    <div class="result-row" style="margin-bottom: 12px;">
      <span class="result-row-label">××—×™×¨ ×œ××˜×¨</span>
      <span class="result-row-value" id="res-price-per-meter"></span>
    </div>

    <div class="divider"></div>

    <div class="result-row" style="margin-bottom: 8px;">
      <span class="result-row-label" style="font-size:15px;">××—×™×¨ ×œ×œ× ××¢"×</span>
      <span class="price-ex-vat" id="res-ex-vat"></span>
    </div>
    <div class="result-row" style="margin-bottom: 12px;">
      <span class="result-row-label" style="color: var(--muted);">××¢"× (18%)</span>
      <span class="vat-val" id="res-vat"></span>
    </div>

    <div class="final-box">
      <div class="final-row">
        <span class="final-label">ğŸ’° ××—×™×¨ ×›×•×œ×œ ××¢"×</span>
        <span class="final-value" id="res-inc-vat"></span>
      </div>
    </div>
  </div>

  <!-- Discount Card -->
  <div class="card" id="discount-card">
    <div class="section-title">ğŸ·ï¸ ×”× ×—×” ×œ×œ×§×•×—</div>

    <div class="field" style="margin-bottom: 16px;">
      <label class="field-label" for="discountPct">% ××—×•×– ×”× ×—×”</label>
      <input type="number" id="discountPct" placeholder="×œ×“×•×’××”: 10" min="0" max="100" step="any" oninput="applyDiscount()"/>
    </div>

    <div class="discount-result-box" id="discount-result-box">
      <div class="discount-row">
        <span class="discount-row-label" id="discount-pct-label"></span>
        <span class="discount-row-value" id="discount-amount"></span>
      </div>
      <div class="discount-final-row">
        <span class="discount-final-label">ğŸ’š ××—×™×¨ ××—×¨×™ ×”× ×—×”</span>
        <span class="discount-final-value" id="price-after-discount"></span>
      </div>
    </div>
  </div>

  <!-- Scientific Calculator Button -->
  <button class="btn-sci" onclick="document.getElementById('calc-modal').classList.add('open')">ğŸ§® ××—×©×‘×•×Ÿ ××“×¢×™</button>

  <!-- Scientific Calculator Modal -->
  <div id="calc-modal" onclick="if(event.target===this)this.classList.remove('open')">
    <div class="calc-panel">
      <button class="calc-close" onclick="document.getElementById('calc-modal').classList.remove('open')">âœ•</button>
      <div class="calc-title">ğŸ§® Scientific Calculator</div>

      <div class="calc-display">
        <div class="calc-expr" id="sc-expr"></div>
        <div class="calc-main" id="sc-main">0</div>
      </div>

      <div class="calc-angle">
        <label><input type="radio" name="angle" value="deg" checked onchange="scAngle='deg'"> DEG</label>
        <label><input type="radio" name="angle" value="rad" onchange="scAngle='rad'"> RAD</label>
      </div>

      <div class="calc-grid">
        <!-- Row 0: trig -->
        <button class="cb cb-fn" onclick="scFn('sin')">sin</button>
        <button class="cb cb-fn" onclick="scFn('cos')">cos</button>
        <button class="cb cb-fn" onclick="scFn('tan')">tan</button>
        <button class="cb cb-fn" onclick="scFn('log')">log</button>
        <button class="cb cb-fn" onclick="scFn('ln')">ln</button>
        <!-- Row 1: inverse trig -->
        <button class="cb cb-fn" onclick="scFn('asin')">sinâ»Â¹</button>
        <button class="cb cb-fn" onclick="scFn('acos')">cosâ»Â¹</button>
        <button class="cb cb-fn" onclick="scFn('atan')">tanâ»Â¹</button>
        <button class="cb cb-fn" onclick="scFn('sqrt')">âˆš</button>
        <button class="cb cb-fn" onclick="scFn('sq')">xÂ²</button>
        <!-- Row 2: power -->
        <button class="cb cb-fn" onclick="scOp('^')">xÊ¸</button>
        <button class="cb cb-fn" onclick="scFn('10x')">10Ë£</button>
        <button class="cb cb-fn" onclick="scFn('ex')">eË£</button>
        <button class="cb cb-fn" onclick="scFn('fact')">n!</button>
        <button class="cb cb-fn" onclick="scFn('inv')">1/x</button>
        <!-- Row 3: constants + clear -->
        <button class="cb cb-fn" onclick="scConst('pi')">Ï€</button>
        <button class="cb cb-fn" onclick="scConst('e')">e</button>
        <button class="cb cb-acc" onclick="scParen()">( )</button>
        <button class="cb cb-clr" onclick="scCE()">CE</button>
        <button class="cb cb-clr" onclick="scC()">C</button>
        <!-- Row 4 -->
        <button class="cb cb-num" onclick="scNum('7')">7</button>
        <button class="cb cb-num" onclick="scNum('8')">8</button>
        <button class="cb cb-num" onclick="scNum('9')">9</button>
        <button class="cb cb-op"  onclick="scOp('/')">Ã·</button>
        <button class="cb cb-acc" onclick="scBack()">âŒ«</button>
        <!-- Row 5 -->
        <button class="cb cb-num" onclick="scNum('4')">4</button>
        <button class="cb cb-num" onclick="scNum('5')">5</button>
        <button class="cb cb-num" onclick="scNum('6')">6</button>
        <button class="cb cb-op"  onclick="scOp('*')">Ã—</button>
        <button class="cb cb-op"  onclick="scFn('pct')">%</button>
        <!-- Row 6 -->
        <button class="cb cb-num" onclick="scNum('1')">1</button>
        <button class="cb cb-num" onclick="scNum('2')">2</button>
        <button class="cb cb-num" onclick="scNum('3')">3</button>
        <button class="cb cb-op"  onclick="scOp('-')">âˆ’</button>
        <button class="cb cb-eq"  onclick="scEq()" style="grid-row: span 2; height: auto;">ï¼</button>
        <!-- Row 7 -->
        <button class="cb cb-op"  onclick="scNegate()">+/âˆ’</button>
        <button class="cb cb-num" onclick="scNum('0')">0</button>
        <button class="cb cb-num" onclick="scDot()">.</button>
        <button class="cb cb-op"  onclick="scOp('+')">+</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">Â© 2026 MICROJUK Israel Â· Internal Use Only</div>

  <script>
    function fmt(n) {
      return 'â‚ª' + n.toLocaleString('he-IL', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function calculate() {
      const errEl = document.getElementById('error-msg');
      const resCard = document.getElementById('results-card');

      const lengthCm     = parseFloat(document.getElementById('cylinderLength').value);
      const runningMeter = parseFloat(document.getElementById('runningMeter').value);
      const pricePerMeter= parseFloat(document.getElementById('pricePerMeter').value);

      // Validate
      if (isNaN(lengthCm) || lengthCm <= 0 ||
          isNaN(runningMeter) || runningMeter <= 0 ||
          isNaN(pricePerMeter) || pricePerMeter <= 0) {
        errEl.style.display = 'block';
        errEl.textContent = '×× × ×”×–×Ÿ ×¢×¨×›×™× ×—×™×•×‘×™×™× ×‘×›×œ ×”×©×“×•×ª';
        resCard.style.display = 'none';
        return;
      }

      errEl.style.display = 'none';
      document.getElementById('discount-card').style.display = 'none';

      const lengthM      = lengthCm / 100;
      const priceExVat   = lengthM * runningMeter * pricePerMeter;
      const vatAmount    = priceExVat * 0.18;
      const priceIncVat  = priceExVat * 1.18;

      _priceIncVat = priceIncVat;

      document.getElementById('res-length').textContent          = lengthCm.toLocaleString('he-IL') + ' ×¡"×';
      document.getElementById('res-running').textContent         = runningMeter.toLocaleString('he-IL') + ' ×\'';
      document.getElementById('res-price-per-meter').textContent = fmt(pricePerMeter);
      document.getElementById('res-ex-vat').textContent          = fmt(priceExVat);
      document.getElementById('res-vat').textContent             = fmt(vatAmount);
      document.getElementById('res-inc-vat').textContent         = fmt(priceIncVat);

      resCard.style.display = 'block';

      // show discount card, reset input
      document.getElementById('discount-card').style.display = 'block';
      document.getElementById('discountPct').value = '';
      document.getElementById('discount-result-box').style.display = 'none';

      resCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    let _priceIncVat = 0;

    function applyDiscount() {
      const pct = parseFloat(document.getElementById('discountPct').value);
      const box = document.getElementById('discount-result-box');

      if (isNaN(pct) || pct < 0 || pct > 100) {
        box.style.display = 'none';
        return;
      }

      const discountAmount   = _priceIncVat * pct / 100;
      const priceAfterDiscount = _priceIncVat - discountAmount;

      document.getElementById('discount-pct-label').textContent  = `×”× ×—×” (${pct}%)`;
      document.getElementById('discount-amount').textContent      = `- ${fmt(discountAmount)}`;
      document.getElementById('price-after-discount').textContent = fmt(priceAfterDiscount);

      box.style.display = 'block';
    }

    // Allow Enter key to calculate
    document.addEventListener('keydown', e => { if (e.key === 'Enter') calculate(); });

    // â”€â”€ Scientific Calculator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let scCurrent = '0', scExpr = '', scStored = 0, scOper = '', scNewEntry = true, scOpenParens = 0;
    let scAngle = 'deg';

    function scToRad(d) { return d * Math.PI / 180; }
    function scFromRad(r) { return r * 180 / Math.PI; }

    function scUpdate() {
      document.getElementById('sc-main').textContent = scCurrent;
      document.getElementById('sc-expr').textContent = scExpr;
    }

    function scVal() { return parseFloat(scCurrent) || 0; }

    function scShowResult(r) {
      scCurrent = (r % 1 === 0 && Math.abs(r) < 1e15) ? String(Math.trunc(r)) : r.toPrecision(10).replace(/\.?0+$/, '');
      scNewEntry = true;
      scUpdate();
    }

    function scNum(d) {
      if (scNewEntry) { scCurrent = d; scNewEntry = false; }
      else scCurrent = scCurrent === '0' ? d : scCurrent + d;
      scUpdate();
    }

    function scDot() {
      if (scNewEntry) { scCurrent = '0.'; scNewEntry = false; }
      else if (!scCurrent.includes('.')) scCurrent += '.';
      scUpdate();
    }

    function scNegate() {
      if (scCurrent !== '0') scCurrent = scCurrent.startsWith('-') ? scCurrent.slice(1) : '-' + scCurrent;
      scUpdate();
    }

    function scOp(op) {
      if (!scNewEntry && scOper && op !== '^') scCalc();
      scStored = scVal(); scOper = op;
      const d = {'+':'+','-':'âˆ’','*':'Ã—','/':'Ã·','^':'^'}[op] || op;
      scExpr = `${scStored} ${d}`; scNewEntry = true; scUpdate();
    }

    function scCalc() {
      const r = scVal();
      const d = {'+':'+','-':'âˆ’','*':'Ã—','/':'Ã·'}[scOper] || scOper;
      let res;
      switch(scOper) {
        case '+': res = scStored + r; break;
        case '-': res = scStored - r; break;
        case '*': res = scStored * r; break;
        case '/': res = r !== 0 ? scStored / r : NaN; break;
        case '^': res = Math.pow(scStored, r); break;
        default:  res = r;
      }
      scExpr = `${scStored} ${d} ${r} =`; scOper = ''; scStored = 0;
      if (isNaN(res)) { scCurrent = 'Error'; scNewEntry = true; scUpdate(); return; }
      scShowResult(res);
    }

    function scEq() { if (scOper) scCalc(); }

    function scFn(fn) {
      const v = scVal();
      const toR = scAngle === 'deg';
      let res;
      switch(fn) {
        case 'sin':  res = Math.sin(toR ? scToRad(v) : v); break;
        case 'cos':  res = Math.cos(toR ? scToRad(v) : v); break;
        case 'tan':  res = Math.tan(toR ? scToRad(v) : v); break;
        case 'asin': res = toR ? scFromRad(Math.asin(v)) : Math.asin(v); break;
        case 'acos': res = toR ? scFromRad(Math.acos(v)) : Math.acos(v); break;
        case 'atan': res = toR ? scFromRad(Math.atan(v)) : Math.atan(v); break;
        case 'log':  res = Math.log10(v); break;
        case 'ln':   res = Math.log(v); break;
        case 'sqrt': res = Math.sqrt(v); break;
        case 'sq':   res = v * v; break;
        case '10x':  res = Math.pow(10, v); break;
        case 'ex':   res = Math.exp(v); break;
        case 'fact': res = scFactorial(v); break;
        case 'inv':  res = v !== 0 ? 1 / v : NaN; break;
        case 'pct':  res = v / 100; break;
        default:     res = v;
      }
      const lbl = {sin:'sin',cos:'cos',tan:'tan',asin:'sinâ»Â¹',acos:'cosâ»Â¹',atan:'tanâ»Â¹',log:'log',ln:'ln',sqrt:'âˆš',sq:'sqr','10x':'10^',ex:'e^',fact:'!',inv:'1/',pct:'%'}[fn] || fn;
      scExpr = `${lbl}(${v})`;
      if (isNaN(res) || !isFinite(res)) { scCurrent = 'Error'; scNewEntry = true; scUpdate(); return; }
      scShowResult(res);
    }

    function scFactorial(n) {
      if (n < 0 || n !== Math.floor(n) || n > 170) return NaN;
      let r = 1; for (let i = 2; i <= n; i++) r *= i; return r;
    }

    function scConst(c) {
      scCurrent = c === 'pi' ? Math.PI.toPrecision(10) : Math.E.toPrecision(10);
      scExpr = c === 'pi' ? 'Ï€' : 'e'; scNewEntry = true; scUpdate();
    }

    function scParen() {
      if (scOpenParens === 0 || scNewEntry) { scExpr += '('; scOpenParens++; scNewEntry = true; }
      else { scExpr += `${scCurrent})`; scOpenParens--; }
      scUpdate();
    }

    function scC()  { scCurrent='0'; scExpr=''; scStored=0; scOper=''; scNewEntry=true; scOpenParens=0; scUpdate(); }
    function scCE() { scCurrent='0'; scNewEntry=true; scUpdate(); }
    function scBack() {
      if (scNewEntry || scCurrent.length <= 1) { scCurrent='0'; scNewEntry=true; }
      else { scCurrent = scCurrent.slice(0,-1); if (scCurrent==='-') scCurrent='0'; }
      scUpdate();
    }

    // PWA install prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('install-banner').style.display = 'flex';
    });

    document.getElementById('install-btn').addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') document.getElementById('install-banner').style.display = 'none';
      deferredPrompt = null;
    });
  </script>

</body>
</html>
